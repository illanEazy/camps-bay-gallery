{% extends 'gallery/base.html' %}
{% load static %}

{% block title %}Profile - Camps Bay Art Gallery{% endblock %}

{% block content %}
<section class="profile-section">
    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar">
                {% if profile.profile_picture %}
                    <img src="{{ profile.profile_picture.url }}" alt="{{ user.get_full_name }}">
                {% else %}
                    <div class="avatar-placeholder" style="background: #3498db; color: white; display: flex; align-items: center; justify-content: center; font-size: 40px;">
                        {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                    </div>
                {% endif %}
            </div>
            <div class="profile-info">
                <h1 class="h1">{{ user.get_full_name }}</h1>
                <div class="profile-role {{ user.role }}">
                    {{ user.get_role_display }}
                </div>
                <p class="text-gray mt-sm">{{ user.email }}</p>
                {% if user.phone %}
                <p class="text-gray">{{ user.phone }}</p>
                {% endif %}
            </div>
        </div>
        
        <div class="profile-grid grid-2">
            <div class="profile-card">
                <h2 class="h3">Personal Information</h2>
                
                <form method="POST" enctype="multipart/form-data" class="auth-form">
                    {% csrf_token %}
                    
                    {% if form.non_field_errors %}
                    <div class="error-message mb-md">
                        {% for error in form.non_field_errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="form-group">
                        <label for="id_profile_picture">Profile Picture</label>
                        {{ form.profile_picture }}
                        {% if form.profile_picture.errors %}
                        <div class="error-message">
                            {{ form.profile_picture.errors }}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="id_bio">Bio</label>
                        {{ form.bio }}
                        {% if form.bio.errors %}
                        <div class="error-message">
                            {{ form.bio.errors }}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="id_address">Address</label>
                        {{ form.address }}
                        {% if form.address.errors %}
                        <div class="error-message">
                            {{ form.address.errors }}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="form-row grid-2">
                        <div class="form-group">
                            <label for="id_city">City</label>
                            {{ form.city }}
                            {% if form.city.errors %}
                            <div class="error-message">
                                {{ form.city.errors }}
                            </div>
                            {% endif %}
                        </div>
                        <div class="form-group">
                            <label for="id_country">Country</label>
                            {{ form.country }}
                            {% if form.country.errors %}
                            <div class="error-message">
                                {{ form.country.errors }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox-label">
                            {{ form.newsletter_subscription }}
                            <span class="text-small">Subscribe to newsletter</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="auth-btn mt-md">Update Profile</button>
                </form>
            </div>
            
            <div class="profile-card">
                <h2 class="h3">Account Details</h2>
                
                <div class="account-info">
                    <div class="info-item mb-md">
                        <div class="text-small text-gray mb-xs">Email</div>
                        <div class="text-regular">{{ user.email }}</div>
                    </div>
                    
                    <div class="info-item mb-md">
                        <div class="text-small text-gray mb-xs">Member Since</div>
                        <div class="text-regular">{{ user.created_at|date:"F j, Y" }}</div>
                    </div>
                    
                    <div class="info-item mb-lg">
                        <div class="text-small text-gray mb-xs">Email Verified</div>
                        <div class="text-regular">
                            {% if user.is_email_verified %}
                            <span class="text-success">✓ Verified</span>
                            {% else %}
                            <span class="text-error">✗ Not Verified</span>
                            <a href="#" class="text-small text-secondary ml-sm">Resend verification</a>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Updated account actions section -->
                    <div class="account-actions mt-xl">
                        <a href="{% url 'logout' %}" class="btn btn-secondary btn-full mb-sm">
                            <i class="fas fa-sign-out-alt mr-xs"></i> Log Out
                        </a>
                        <a href="{% url 'forgot_password' %}" class="btn btn-link text-secondary btn-full mb-sm">
                            <i class="fas fa-key mr-xs"></i> Change Password
                        </a>
                        
                        <!-- Show order history for customers -->
                        {% if user.is_customer %}
                        <a href="#" class="btn btn-link text-secondary btn-full" id="viewOrders">
                            <i class="fas fa-shopping-bag mr-xs"></i> View My Orders
                        </a>
                        {% endif %}
                        
                        <!-- Show admin dashboard link for owners -->
                        {% if user.is_owner %}
                        <a href="{% url 'admin_dashboard' %}" class="btn btn-primary btn-full mt-md">
                            <i class="fas fa-tachometer-alt mr-xs"></i> Go to Admin Dashboard
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}